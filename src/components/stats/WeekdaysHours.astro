---
import { movies as watchlist } from "../../data/movies.ts";

const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"] as const;
const dayCounter = {
  "Monday": 0,
  "Tuesday": 0,
  "Wednesday": 0,
  "Thursday": 0,
  "Friday": 0,
  "Saturday": 0,
  "Sunday": 0,
};


watchlist
  .filter((m) => m.watched)
  .forEach((movie) => {
    const dayIndex = new Date(movie.watched!).getDay();
    const day = dayNames[dayIndex];
    const n = dayCounter[day];
    dayCounter[day] = n + movie.runtime;
  });

const formattedData = JSON.stringify(Object.entries(dayCounter).map(([day, minutes]) => ({
    day: day,
    hours: (minutes / 60)
})));
---

<div id="weekdayhoursplot" class="m-auto" data-days={formattedData}></div>

<script>
import * as Plot from "@observablehq/plot";

interface DayHoursStat {
  day: string;
  hours: number;
}

const div = document.querySelector<HTMLDivElement>("#weekdayhoursplot");
const weekdays = JSON.parse(div?.dataset.days as string) as DayHoursStat[];

const plot = Plot.plot({
  width: undefined,
  height: 300,
  y: {
    grid: true,
    label: "hours",
    percent: false
  },
  x: {
    type: "band",
    label: null,
    // keep the original array order; avoid default alphanumerical sorting
    domain: weekdays.map(wd => wd.day)
  },
  marks: [
    Plot.ruleY([0]),
    Plot.barY(weekdays as Plot.Data, {x: "day", y: "hours", fill: "steelblue", ry1: 8, insetLeft: 8, insetRight: 8}),
    Plot.tip(weekdays, Plot.pointerX({title: (d) => `${d.hours.toFixed(1)} h`, x: "day", y: "hours"}))
  ]
})

document.querySelector("#weekdayplot")?.append(plot);
</script>
